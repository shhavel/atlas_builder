#!/usr/bin/env ruby
# encoding: utf-8
require 'google_translate_scraper'
require 'nokogiri'

class Interpreter
  class << self
    def translate_html(html, from='ru', to='uk')
      paragraphs = Nokogiri::HTML(html).css('p').map(&:text)
      translated_paragraphs = paragraphs.map{|p| translate_text(p, from, to) }
      return nil if translated_paragraphs.size != paragraphs.size
      '<p>' + translated_paragraphs.join("</p>\n<p>") + '</p>'
    end

    def translate_text(text, from='ru', to='uk')
      response = GoogleTranslateScraper.translate(source_language: from, target_language: to, search_text: text)
      response.translations.first.translated_text #rescue nil
    end
  end
end

def write_collection(collection, collection_name)
  File.open("#{collection_name}.rb", 'w') do |f|
    f.write("#{collection_name} = [\n")
    collection.each do |c|
      f.write("  {\n")
      c.each do |k, v|
        next if k == 'name_ru' || k == 'name_ua'
        f.write("    '#{k}'=>\"#{v.gsub('"', '\\"')}\",\n")
        if k == 'name'
          f.write("    'name_ru'=>\"#{c['name_ru'].gsub('"', '\\"')}\",\n") if c['name_ru']
          f.write("    'name_ua'=>\"#{c['name_ua'].gsub('"', '\\"')}\",\n") if c['name_ua']
        end
      end 
      f.write("  },\n")
    end
    f.write("]\n")
  end
end

categories = [{'sign'=>'resources', 'name'=>"География природных ресурсов"}, {'sign'=>'population', 'name'=>"География населения"}, {'sign'=>'politics', 'name'=>"Политическое устройство мира"}, {'sign'=>'industry', 'name'=>"Мировое хозяйство"}, {'sign'=>'economy', 'name'=>"Региональная география (экономические карты)"}, {'sign'=>'problems', 'name'=>"Глобальные проблемы человечества"}]
maps = [{'category_sign'=>"resources", 'name'=>"Физическая карта мира", 'file'=>"1", 'summary'=>"01", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Минеральные ресурсы", 'file'=>"2_Mineralnye_resursy", 'summary'=>"13", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Земельные ресурсы", 'file'=>"3_Zemelni_resursy", 'summary'=>"16", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Агроклиматические ресурсы и типы зимы", 'file'=>"4_Agroklimat_res_Tipy_zimy", 'summary'=>"19", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Биологические ресурсы", 'file'=>"5_Biolog_resursy", 'summary'=>"18", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Ресурсы мирового океана", 'file'=>"6_Resur_mir_okeana", 'summary'=>"15", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Водные ресурсы", 'file'=>"7_Vodnye_resursy", 'summary'=>"17", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Топливные и геотермальные ресурсы", 'file'=>"8_Toplivnye_resursy", 'summary'=>"14", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"resources", 'name'=>"Рекреационные ресурсы. Туризм. Направления мирового туризма", 'file'=>"9_Rekreatsionnye_res_Turizm", 'summary'=>"20", 'pictures_list'=>"r_3", 'legend'=>"lMain", 'questionnaire'=>"03"}, {'category_sign'=>"population", 'name'=>"Размещение населения", 'file'=>"10_Razmeshenie_naseleniya", 'summary'=>"06", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"population", 'name'=>"Внешние миграции", 'file'=>"Migration", 'summary'=>"07_M", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"population", 'name'=>"Народы", 'file'=>"11_Narody", 'summary'=>"10", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"population", 'name'=>"Религии", 'file'=>"12_Religii", 'summary'=>"09", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"population", 'name'=>"Продолжительность жизни. Половой состав населения", 'file'=>"13_Prodolzhit_zhizni_Polovoy_sostav", 'summary'=>"08", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"population", 'name'=>"Урбанизация. Естественный прирост населения", 'file'=>"14_Urbanizatsiya_Estestv_prirost_nasel", 'summary'=>"07", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"population", 'name'=>"Занятость населения в сельском, лесном и рыбном хозяйстве. Занятость населения в индустриальных отраслях хозяйства", 'file'=>"15_Zanyatost_nasel_sel_hoz_industr_otrasl", 'summary'=>"11", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"population", 'name'=>"Занятость населения в обслуживающих отраслях хозяйства. Безработица", 'file'=>"16_zanyat_naserl_obsluzh_Bezrabotitsa", 'summary'=>"12", 'pictures_list'=>"r_2", 'legend'=>"lMain", 'questionnaire'=>"02"}, {'category_sign'=>"politics", 'name'=>"Политическая карта мира", 'file'=>"17_Page_4-5_2007_CD", 'summary'=>"02", 'pictures_list'=>"r_1", 'legend'=>"lMain", 'questionnaire'=>"01"}, {'category_sign'=>"politics", 'name'=>"Уровень социального и экономического развития стран мира", 'file'=>"18_Uroven_ekon_sots_razv", 'summary'=>"04", 'pictures_list'=>"r_1", 'legend'=>"lMain", 'questionnaire'=>"01"}, {'category_sign'=>"politics", 'name'=>"Государственное устройство", 'file'=>"19_Gosud_ustroystvo", 'summary'=>"03", 'pictures_list'=>"r_1", 'legend'=>"lMain", 'questionnaire'=>"01"}, {'category_sign'=>"politics", 'name'=>"Международные организации", 'file'=>"20_Mezhdunar_organizatsii", 'summary'=>"05", 'pictures_list'=>"r_1", 'legend'=>"lMain", 'questionnaire'=>"01"}, {'category_sign'=>"industry", 'name'=>"Нефтяная и газовая промышленность", 'file'=>"21_Neft_gaz_promyshl", 'summary'=>"21", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Электроэнергетика", 'file'=>"Elektroenergetika_new", 'summary'=>"23", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Угольная и уранодобывающая промышленность", 'file'=>"23_Ugolnaya_uranodob_promyshl", 'summary'=>"22", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Черная металлургия", 'file'=>"24_Chernaya_metallurgiya", 'summary'=>"24", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Цветная металлургия", 'file'=>"tsvetnaya_metallurgiya", 'summary'=>"25", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Машиностроение и металлообработка", 'file'=>"26_Mashinostroenie_metall", 'summary'=>"26", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Химическая промышленность", 'file'=>"27_Himich_promyshlen", 'summary'=>"27", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Текстильная промышленность", 'file'=>"28_Tekstilnaya_promyshl", 'summary'=>"28", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Сельское хозяйство", 'file'=>"29_Selskoe_hozyaystvo", 'summary'=>"29", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Зерновые культуры. Животноводство", 'file'=>"30_Zernovye_Zhivotnovod", 'summary'=>"30", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Технические (масличные и волокнистые) культуры. Технические (свекличные, клубнеплодные и тонизирующие) культуры", 'file'=>"31_Tehnicheskie kultury", 'summary'=>"31", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Транспорт. Сеть международной связи", 'file'=>"Transport", 'summary'=>"32", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"industry", 'name'=>"Международные экономические связи", 'file'=>"33_Mezhdun_ekon_svyazi", 'summary'=>"33", 'pictures_list'=>"r_4", 'legend'=>"lMain", 'questionnaire'=>"04"}, {'category_sign'=>"economy", 'name'=>"Страны Европы", 'file'=>"Europe", 'summary'=>"40", 'pictures_list'=>"r_6", 'legend'=>"lMain", 'questionnaire'=>"06"}, {'category_sign'=>"economy", 'name'=>"Великобритания, Франция, Италия, Бельгия, Швейцария, Нидерланды, Люксембург", 'file'=>"35_Velykobr_Fr_It_Bel_", 'summary'=>"41", 'pictures_list'=>"r_6", 'legend'=>"lMain", 'questionnaire'=>"06"}, {'category_sign'=>"economy", 'name'=>"Германия, Чехия, Словакия, Польша, Белоруссия, Литва", 'file'=>"36_Germ_Cheh_Slov", 'summary'=>"42", 'pictures_list'=>"r_6", 'legend'=>"lMain", 'questionnaire'=>"06"}, {'category_sign'=>"economy", 'name'=>"Страны Азии", 'file'=>"37_Strany_Azii", 'summary'=>"43", 'pictures_list'=>"r_7", 'legend'=>"lMain", 'questionnaire'=>"07"}, {'category_sign'=>"economy", 'name'=>"Китай, Монголия, Республика Корея, КНДР", 'file'=>"38_Kitay_Mongol_Koreya", 'summary'=>"44", 'pictures_list'=>"r_7", 'legend'=>"lMain", 'questionnaire'=>"07"}, {'category_sign'=>"economy", 'name'=>"Индия, Бангладеш, Непал, Бутан, Япония", 'file'=>"39_Ind_Banglad_Nepal_Butan", 'summary'=>"45", 'pictures_list'=>"r_7", 'legend'=>"lMain", 'questionnaire'=>"07"}, {'category_sign'=>"economy", 'name'=>"Канада, Соединенные Штаты Америки", 'file'=>"40_Kanada_USA", 'summary'=>"46", 'pictures_list'=>"r_8", 'legend'=>"lMain", 'questionnaire'=>"08"}, {'category_sign'=>"economy", 'name'=>"Латинская Америка", 'file'=>"41_Latinskaya_Amerika", 'summary'=>"47", 'pictures_list'=>"r_8", 'legend'=>"lMain", 'questionnaire'=>"08"}, {'category_sign'=>"economy", 'name'=>"Африка", 'file'=>"42_Afrika", 'summary'=>"48", 'pictures_list'=>"r_9", 'legend'=>"lMain", 'questionnaire'=>"09"}, {'category_sign'=>"economy", 'name'=>"Австралия и Океания", 'file'=>"43_Australia_Oceaniya", 'summary'=>"49", 'pictures_list'=>"r_9", 'legend'=>"lMain", 'questionnaire'=>"09"}, {'category_sign'=>"problems", 'name'=>"Политическая напряженность", 'file'=>"44_Politicheskaya_napryazhennost", 'summary'=>"34", 'pictures_list'=>"r_5", 'legend'=>"lMain", 'questionnaire'=>"05"}, {'category_sign'=>"problems", 'name'=>"Калорийность питания. Здравоохранение", 'file'=>"45_Kaloriynost_Zdravoohranenie", 'summary'=>"35", 'pictures_list'=>"r_5", 'legend'=>"lMain", 'questionnaire'=>"05"}, {'category_sign'=>"problems", 'name'=>"Экологические проблемы", 'file'=>"46_Ekolog_problemy", 'summary'=>"36", 'pictures_list'=>"r_5", 'legend'=>"lMain", 'questionnaire'=>"05"}, {'category_sign'=>"problems", 'name'=>"Охрана природы", 'file'=>"47_Ohrana_prirody", 'summary'=>"37", 'pictures_list'=>"r_5", 'legend'=>"lMain", 'questionnaire'=>"05"}, {'category_sign'=>"problems", 'name'=>"Выбросы углекислого газа. Неграмотность", 'file'=>"48_Vybrosy_uglek_gaza_Negramotnost", 'summary'=>"38", 'pictures_list'=>"r_5", 'legend'=>"lMain", 'questionnaire'=>"05"}, {'category_sign'=>"problems", 'name'=>"Образование и наука", 'file'=>"49_Obrazovanie_Nauka", 'summary'=>"39", 'pictures_list'=>"r_5", 'legend'=>"lMain", 'questionnaire'=>"05"}]

categories.each{|c| c['name_ua'] = Interpreter.translate_text(c['name']); puts c['name']; puts c['name_ua']; }
write_collection(categories, 'categories')

maps.each{|m| m['name_ua'] = Interpreter.translate_text(m['name']); puts m['name']; puts m['name_ua']; }
write_collection(maps, 'maps')


